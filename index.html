<!DOCTYPE html>
<html lang="id" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Undangan Fulan & Fulanah</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght400;700&display=swap" rel="stylesheet">

    <style>
        /* 1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠØª */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Amiri', serif;
        }

        body {
            background: #1e1f0d; /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© */
            color: #fff;
            overflow-x: hidden;
            text-align: left;
        }

        /* Ù…Ù†Ø¹ Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ± (Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù„Ù…Ø³) */
        img {
            -webkit-user-drag: none;
            user-drag: none;
            -webkit-touch-callout: none;
            pointer-events: auto;
            user-select: none;
        }

        /* 2. Ø´Ø§Ø´Ø© Ø§Ù„ØºÙ„Ø§Ù (Cover) */
        #cover {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            /* ÙŠØ¬Ø¨ ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ */
            background: url('cover-image.jpg') center/cover no-repeat;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #enterBtn {
            width: 150px;
            cursor: pointer;
            transition: .3s;
        }

        #enterBtn:hover {
            transform: scale(1.05);
        }

        #guestName {
            margin-top: 20px;
            font-size: 20px;
            color: #fff;
        }

        /* 3. Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ (Navigation) */
        #nav {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
            gap: 5px;
            z-index: 1000;
            direction: ltr;
        }

        #nav img {
            width: 28px;
            height: 28px;
            cursor: pointer;
            border-radius: 8px;
            border: none;
        }

        /* 4. Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª (Sections) */
        #pages {
            display: none;
            scroll-snap-type: y mandatory;
        }

        .section {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            position: relative;
            scroll-snap-align: start;
            overflow: hidden;
        }

        .page-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
        }

        /* 5. Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ (Countdown) */
        #countdown {
            display: flex;
            gap: 6px;
            justify-content: center;
            align-items: center;
        }

        .countBox {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }

        .countBox span {
            font-size: 15px;
            color: #9d8d69;
        }

        .countBox small {
            font-size: 9px;
            margin-top: 1px;
            color: #9d8d69;
        }

        /* 6. Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Gallery) */
        .gallery-container {
            width: 90%;
            max-width: 400px;
            overflow-x: scroll;
            white-space: nowrap;
            padding: 10px 0;
            scroll-snap-type: x mandatory;
            -ms-overflow-style: none;
            scrollbar-width: none;
            margin-top: 50px;
            direction: ltr;
        }

        .gallery-container::-webkit-scrollbar {
            display: none;
        }

        .gallery-grid {
            display: flex;
            gap: 10px;
            padding: 0 10px;
        }

        .gallery-item {
            min-width: 140px;
            height: 180px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #9d8d69;
            flex-shrink: 0;
            scroll-snap-align: center;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 7. ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù†Ø³Ø® (Ø§Ù„Ù‡Ø¯ÙŠØ©/Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ) */
        .section#page5 {
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .copy-box-container {
            position: absolute;
            left: 17%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 60px;
            top: 53%;
            transform: translateY(-50%);
        }

        .copy-box {
            width: 55px;
            height: 55px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #9d8d69;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            flex-shrink: 0;
        }

        .copy-box .copy-text {
            font-size: 11px;
            font-weight: bold;
            color: #9d8d69;
        }

        .copy-box:active {
            transform: scale(0.95);
        }

        /* 8. Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙˆØ§Ù„Ù‚Ø§Ø¦Ù…Ø©) */
        .section#page7 {
            justify-content: flex-start;
            align-items: center;
            padding-top: 150px;
            padding-bottom: 70px;
        }

        #commentsWrapper {
            width: 90%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 15px;
            border-radius: 10px;
            background: #fff;
            color: #000;
            max-height: 60vh;
            overflow-y: auto;
            z-index: 10;
            text-align: left;
        }

        .formLabel {
            margin: 5px 0 0;
            font-size: 14px;
            color: #9d8d69;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #9d8d69;
            font-size: 14px;
            margin-bottom: 5px;
            font-family: 'Amiri', serif;
            direction: ltr;
            text-align: left;
            background: #fff;
            color: #000;
        }

        textarea {
            min-height: 80px;
            resize: none;
        }

        button {
            padding: 7px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #9d8d69;
            color: #000;
            font-weight: bold;
            margin-top: 5px;
            transition: background 0.3s;
        }

        button:disabled {
            background: #ccc !important;
            color: #555 !important;
            cursor: not-allowed;
        }

        #sendComment {
            margin-bottom: 15px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø¹Ù†ØµØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ */
        .commentItem {
            border: 1px solid #9d8d69;
            border-radius: 8px;
            padding: 8px;
            background: #fff;
            color: #000;
            font-size: 14px;
            margin-bottom: 8px;
            position: relative;
            direction: ltr;
            text-align: left;
        }

        .timeInfo {
            font-size: 12px;
            color: #777;
            margin-top: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .replyBtn {
            background: #9d8d69;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            padding: 3px 8px;
            border-radius: 5px;
            border: none;
            font-weight: normal;
        }

        .comment-time {
            font-size: 12px;
            color: #777;
        }

        .reply-form {
            padding-top: 5px;
            border-top: 1px dashed #eee;
            margin-top: 5px;
            direction: ltr;
            display: none;
        }

        .reply-item {
            border-top: 1px solid #9d8d69;
            padding: 5px 0 0 0;
            margin-top: 5px;
            font-size: 13px;
            direction: ltr;
            text-align: left;
        }

        .reply-item .reply-text {
            display: block;
            margin-bottom: 3px;
        }

        .reply-item .timeInfo {
            font-size: 10px;
            color: #777;
            text-align: left;
            margin-top: 0;
        }
        
        /* Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ±Ù‚ÙŠÙ… Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù… */
        #paginationControls {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            gap: 10px;
        }

        /* 9. ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© (Footer) - ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¥Ø¹Ø§Ø¯ØªÙ‡ Ù„Ø´ÙƒÙ„Ù‡ Ø§Ù„Ø£ØµÙ„ÙŠ (ØµÙˆØ±Ø© 4) */
        #pageFooter {
            width: 100%;
            position: absolute; /* ğŸ›‘ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ absolute Ù„ØªØ«Ø¨ÙŠØªÙ‡ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© */
            bottom: 50px;      /* ğŸ›‘ ÙˆØ¶Ø¹ Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ */
            left: 0;
            padding: 10px 0;   /* ØªÙ‚Ù„ÙŠÙ„ padding Ù„ÙŠØ¹ÙˆØ¯ Ø´Ø±ÙŠØ·Ø§Ù‹ Ø¶ÙŠÙ‚Ø§Ù‹ */
            text-align: center;
            font-size: 13px;
            background: rgba(0, 0, 0, 0.4); /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© / Ø¯Ø§ÙƒÙ†Ø© */
            color: #aaa;
            z-index: 100;
        }

        #pageFooter a {
            color: #9d8d69;
            text-decoration: none;
            font-weight: bold;
        }
    </style>

</head>
<body>

    <div id="cover">
        <img id="enterBtn" src="enter.png" alt="Tombol Masuk">
        <div id="guestName">Kepada Yth: Sara</div>
    </div>

    <div id="nav">
        <img src="icon1.png" data-go="0" alt="Ikon 1">
        <img src="icon2.png" data-go="1" alt="Ikon 2">
        <img src="icon3.png" data-go="2" alt="Ikon 3">
        <img src="icon4.png" data-go="3" alt="Ikon 4">
        <img src="icon5.png" data-go="4" alt="Ikon 5">
        <img src="icon6.png" data-go="5" alt="Ikon 6">
        <img src="icon7.png" data-go="6" alt="Ikon 7">
    </div>

    <div id="pages">

        <div class="section">
            <video class="page-video" src="page1.mp4" muted loop autoplay playsinline></video>
        </div>

        <div class="section" id="page2">
            <video class="page-video" src="page2.mp4" muted loop autoplay playsinline></video>
            <img class="siteImage" src="site.png" style="margin-top:650px;max-width:50%;cursor:pointer;"
                alt="Gambar Peta Lokasi">
        </div>

        <div class="section" id="page3">
            <video class="page-video" src="page3.mp4" muted loop autoplay playsinline></video>
            <div id="countdown">
                <div class="countBox"><span id="d">0</span><small>Hari</small></div>
                <div class="countBox"><span id="h">0</span><small>Jam</small></div>
                <div class="countBox"><span id="m">0</span><small>Menit</small></div>
                <div class="countBox"><span id="s">0</span><small>Detik</small></div>
            </div>
        </div>

        <div class="section">
            <video class="page-video" src="page4.mp4" muted loop autoplay playsinline></video>
            <div class="gallery-container">
                <div class="gallery-grid">
                    <div class="gallery-item"><img src="g1.jpg" alt="Galeri Gambar 1"></div>
                    <div class="gallery-item"><img src="g2.jpg" alt="Galeri Gambar 2"></div>
                    <div class="gallery-item"><img src="g3.jpg" alt="Galeri Gambar 3"></div>
                    <div class="gallery-item"><img src="g4.jpg" alt="Galeri Gambar 4"></div>
                </div>
            </div>
        </div>

        <div class="section" id="page5">
            <video class="page-video" src="page5.mp4" muted loop autoplay playsinline></video>
            <div class="copy-box-container">
                <div class="copy-box" data-num="081234567890">
                    <span class="copy-text">Salin</span>
                </div>
                <div class="copy-box" data-num="085711223344">
                    <span class="copy-text">Salin</span>
                </div>
            </div>
        </div>

        <div class="section">
            <video class="page-video" src="page6.mp4" muted loop autoplay playsinline></video>
        </div>

        <div class="section" id="page7">
            <video class="page-video" src="page7.mp4" muted loop autoplay playsinline></video>

            <div id="commentsWrapper">
                <div class="formLabel">Nama</div>
                <input type="text" id="cName" placeholder="Contoh: Nurul">

                <div class="formLabel">Status Kehadiran</div>
                <select id="cStatus">
                    <option value="">Pilih Status</option>
                    <option value="Hadir">Hadir</option>
                    <option value="Berhalangan">Berhalangan</option>
                </select>

                <div class="formLabel">Ucapan</div>
                <textarea id="cMsg" placeholder="Contoh: Semoga bahagia selalu..."></textarea>

                <button id="sendComment">Kirim</button>

                <div id="loadingStatus" style="color:#000; margin-top:10px; font-weight:bold; display:none;">
                    Memuat komentar...
                </div>

                <div id="paginationControls">
                    <button id="prevBtn" style="flex:1;">
                        < Sebelumnya
                    </button>
                    <button id="nextBtn" style="flex:1;">
                        Berikutnya >
                    </button>
                </div>
                <div id="commentsList"></div>
            </div>

            <div id="pageFooter">
                Created with love by <a href="https://www.instagram.com/alaleefa_?igsh=MW45Z21oM2x0YndjcQ=="
                    target="blank">@alaleefa_</a>/
                <a href='https://api.whatsapp.com/send/?phone=%2B6281287575722&text&type=phone_number&app_absent=0&wame_ctl=1'>081287575722</a>
            </div>

        </div>

    </div>

    <audio id="music" src="music.mp3" loop></audio>


    <script>
        // ğŸ”´ğŸ”´ğŸ”´ PENTING: GANTI DENGAN URL APPS SCRIPT ANDØ§ ğŸ”´ğŸ”´ğŸ”´
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxRnmOOHc2LpkIlLlQt_PVcVrBoJymZ8T8YzTUdBvuw8aq73FfFH_frF8DBpC6eXs8Fng/exec"; 
        // ğŸ”´ğŸ”´ğŸ”´ ØªØ£ÙƒØ¯ Ù…Ù† Ù†Ø´Ø± Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­! ğŸ”´ğŸ”´ğŸ”´

        // -----------------------------------------------------------------------
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ¹Ù†Ø§ØµØ± DOM
        // -----------------------------------------------------------------------
        const COMMENTS_PER_PAGE = 5;
        let currentPage = 1;
        let allComments = [];
        const commentsList = document.getElementById('commentsList');
        const loadingStatus = document.getElementById('loadingStatus');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const cName = document.getElementById('cName');
        const cMsg = document.getElementById('cMsg');
        const cStatus = document.getElementById('cStatus');
        const sendComment = document.getElementById('sendComment');


        // -----------------------------------------------------------------------
        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UI)
        // -----------------------------------------------------------------------

        /* Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ø¶ÙŠÙ Ù…Ù† Ø±Ø§Ø¨Ø· URL */
        const guestNameParam = new URLSearchParams(location.search).get('guest') || 'Sara';
        document.getElementById('guestName').innerText = "Kepada Yth: " + guestNameParam;

        /* ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰/Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        enterBtn.onclick = () => {
            cover.style.display = "none";
            pages.style.display = "block";
            nav.style.display = "flex";
            // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰
            music.play().catch(e => console.error("Autoplay gagal:", e));

            // ØªØ´ØºÙŠÙ„ Ø¬Ù…ÙŠØ¹ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©
            document.querySelectorAll('.page-video').forEach(v => v.play());
        };

        /* ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„) */
        document.querySelectorAll('#nav img').forEach(btn => {
            btn.onclick = () => document.querySelectorAll('.section')[btn.dataset.go]
                .scrollIntoView({
                    behavior: 'smooth'
                });
        });

        /* ÙØªØ­ Ø±Ø§Ø¨Ø· Google Maps Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ */
        document.querySelector('.siteImage').onclick = () => {
            // ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø§Ù„ÙØ¹Ù„ÙŠ
            window.open('https://maps.app.goo.gl/fipYv9RUQYJmwTDq6','_blank');
        };

        /* ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ */
        let targetDate = new Date("2026-09-07T00:00:00").getTime(); // ØªØºÙŠÙŠØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù Ù‡Ù†Ø§
        setInterval(() => {
            let diff = targetDate - Date.now();
            if (diff < 0) diff = 0;
            d.innerText = Math.floor(diff / 86400000);
            h.innerText = Math.floor((diff % 86400000) / 3600000);
            m.innerText = Math.floor((diff % 3600000) / 60000);
            s.innerText = Math.floor((diff % 60000) / 1000);
        }, 1000);

        /* ÙˆØ¸ÙŠÙØ© Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨/Ø§Ù„Ù‡Ø¯ÙŠØ© */
        document.querySelectorAll('.copy-box').forEach(box => {
            box.onclick = () => {
                navigator.clipboard.writeText(box.dataset.num);
                box.style.background = "rgba(157,141,105,0.7)";
                box.querySelector('.copy-text').innerText = 'Disalin!';
                setTimeout(() => {
                    box.style.background = "rgba(255,255,255,0.2)";
                    box.querySelector('.copy-text').innerText = 'Salin';
                }, 800);
            };
        });

        // -----------------------------------------------------------------------
        // ÙˆØ¸ÙŠÙØ© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® (ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ù„Ø¶Ù…Ø§Ù† AM/PM ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙƒØ§Ù…Ù„)
        // -----------------------------------------------------------------------
        /**
         * ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ù„ÙŠØ¸Ù‡Ø± Ø¨ØªÙ†Ø³ÙŠÙ‚ 12 Ø³Ø§Ø¹Ø© Ù…Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙƒØ§Ù…Ù„ (Ù…Ø«Ø§Ù„: 11/28/2025, 06:13 PM)
         * @param {string} dateString - ØªØ§Ø±ÙŠØ® Ø®Ø§Ù… Ù…Ù† Google Sheet.
         * @returns {string} Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø³Ù‚.
         */
        function formatCommentTime(dateString) {
            const date = new Date(dateString);
            if (isNaN(date)) {
                return dateString.split(' ')[1] || dateString; 
            }
            
            // ğŸ›‘ Ø§Ù„Ø¥ØµÙ„Ø§Ø­: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ (en-US) Ù„Ø¶Ù…Ø§Ù† AM/PM ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙƒØ§Ù…Ù„
            const dateTimeOptions = { 
                year: 'numeric',
                month: '2-digit', // Ø´Ù‡Ø± Ø±Ù‚Ù…ÙŠ
                day: '2-digit',    // ÙŠÙˆÙ… Ø±Ù‚Ù…ÙŠ
                hour: '2-digit',  
                minute: '2-digit',  
                hour12: true, // Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± AM/PM
            };

            // Ø§Ø³ØªØ®Ø¯Ø§Ù… 'en-US' Ù„Ø¶Ù…Ø§Ù† AM/PM ÙˆÙØµÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø¨Ù€ ','
            return date.toLocaleString('en-US', dateTimeOptions);
        }


        // =======================================================================
        // ğŸš€ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Google Apps Script ğŸš€
        // =======================================================================

        /**
         * 1. Ø¬Ù„Ø¨ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ù† Google Sheet (GET)
         */
        async function getCommentsFromSheet() {
            loadingStatus.style.display = 'block';
            const url = `${APPS_SCRIPT_URL}?action=getComments`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Kesalahan HTTP! status: ${response.status}`);
                }

                let commentsData = await response.json();

                // ØªØ·Ø¨ÙŠÙ‚ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
                allComments = commentsData.map(c => ({
                    id: c.id,
                    name: c.name,
                    status: c.status,
                    msg: c.comment,
                    // ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙƒÙƒØ§Ø¦Ù† Date Ù„Ù„ÙØ±Ø²
                    dateObject: new Date(c.date),  
                    // ØªØ®Ø²ÙŠÙ† Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ø³Ù‚ Ù„Ù„Ø¹Ø±Ø¶ (Ø¨ØµÙŠØºØ© AM/PM)
                    time: formatCommentTime(c.date), 
                    parentId: c.replyTo || null,
                    replyToName: c.replyTo || null
                }));

            } catch (error) {
                console.error("Gagal mengambil komentar:", error);
                // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©
                alert("Gagal memuat komentar. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Apps Script Ù…Ù†Ø´ÙˆØ± Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ ÙˆØ£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù…Ù„Ù HTML Ù‡Ùˆ Ø§Ù„Ø£Ø­Ø¯Ø«.");
                allComments = [];
            } finally {
                loadingStatus.style.display = 'none';
            }
        }

        /**
         * 2. Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚/Ø±Ø¯ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Google Sheet (POST)
         */
        async function addCommentToSheet(data) {
            // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…ØªØ¹Ø¯Ø¯
            sendComment.disabled = true;
            prevBtn.disabled = true;
            nextBtn.disabled = true;

            const postData = {
                action: 'addComment',
                name: data.name,
                status: data.status,
                comment: data.msg,
                replyTo: data.parentId || ""
            };

            try {
                // Ù…ÙˆØ¯ 'no-cors' Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Apps Script
                await fetch(APPS_SCRIPT_URL, { 
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(postData)
                });

                // *Ù…Ù†Ø·Ù‚ Ø§Ù„Ù†Ø¬Ø§Ø­:* //
                cName.value = "";
                cMsg.value = "";
                cStatus.value = "";
                
                // Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (ÙŠØ¶Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ§Ù„ØªØ±ØªÙŠØ¨)
                await initComments();

                // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                if (!data.parentId) {
                    currentPage = 1;
                }

            } catch (error) {
                console.error("Kesalahan saat menambahkan komentar:", error);
                alert("Gagal mengirim komentar. Cek Apps Script URL.");
            } finally {
                sendComment.disabled = false;
                prevBtn.disabled = false; // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙƒÙŠÙ† Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
                nextBtn.disabled = false;
            }
        }

        /**
         * 3. Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ø¹ ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª
         */
        function renderComments() {
            commentsList.innerHTML = "";

            // ğŸ›‘ Ø§Ù„Ø¥ØµÙ„Ø§Ø­: Ø§Ù„ÙØ±Ø² Ø­Ø³Ø¨ dateObject ØªÙ†Ø§Ø²Ù„ÙŠØ§Ù‹ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
            const sortedComments = allComments
                .sort((a, b) => b.dateObject - a.dateObject);

            // ØªØµÙÙŠØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            const mainComments = sortedComments
                .filter(c => !c.parentId || c.parentId === 'null' || c.parentId === '');

            const totalMainComments = mainComments.length;
            const totalPages = Math.ceil(totalMainComments / COMMENTS_PER_PAGE);

            // Ø­Ø³Ø§Ø¨ ÙÙ‡Ø§Ø±Ø³ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const startIndex = (currentPage - 1) * COMMENTS_PER_PAGE;
            const endIndex = startIndex + COMMENTS_PER_PAGE;

            // Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            const commentsToDisplay = mainComments.slice(startIndex, endIndex);

            // --- Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø£Ø²Ø±Ø§Ø± ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª ---
            prevBtn.disabled = (currentPage === 1);
            nextBtn.disabled = (currentPage >= totalPages) || (totalMainComments <= COMMENTS_PER_PAGE);

            // --- Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ---
            commentsToDisplay.forEach((mainC) => {
                let mainDiv = document.createElement('div');
                mainDiv.className = "commentItem";
                mainDiv.id = `comment-${mainC.id}`;

                // Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (ÙŠØªÙ… ÙØ±Ø²Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø£ØµÙ„ÙŠ ØªØµØ§Ø¹Ø¯ÙŠØ§Ù‹)
                const replies = allComments
                    .filter(r => r.parentId === mainC.id)
                    // Ø§Ù„Ø±Ø¯ÙˆØ¯ ØªØ¸Ù‡Ø± Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²Ù…Ù†ÙŠ (Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹)
                    .sort((a, b) => a.dateObject - b.dateObject); 

                let mainContent = `
                    <div style="direction: ltr; text-align: left;">
                        <b>${mainC.name}</b> (${mainC.status})<br>
                        ${mainC.msg}
                        <div class="timeInfo">
                            <button class="replyBtn" data-id="${mainC.id}" data-name="${mainC.name}">Balas</button>
                            <span class="comment-time">${mainC.time}</span>
                        </div>
                    </div>
                    <div class="reply-list" id="replies-for-${mainC.id}">
                        ${replies.map(r => `
                            <div class="reply-item">
                                <b>${r.name}:</b>
                                <span class="reply-text">${r.msg}</span>
                                <div class="timeInfo">${r.time}</div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="reply-form" id="replyForm-${mainC.id}">
                        <div class="formLabel">Nama</div>
                        <input type="text" id="rName-${mainC.id}" placeholder="Nama Anda">
                        <div class="formLabel">Komen</div>
                        <textarea id="rMsg-${mainC.id}" placeholder="Balasan untuk ${mainC.name}..."></textarea>
                        <button class="sendReplyBtn" data-parent-id="${mainC.id}" data-parent-name="${mainC.name}">Kirim</button>
                    </div>
                `;
                mainDiv.innerHTML = mainContent;
                commentsList.appendChild(mainDiv);
            });

            // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø¨Ø· Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            attachEventListeners();
        }

        /**
         * 4. Ø±Ø¨Ø· Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¯ÙˆØ¯ ÙˆØ§Ù„ØµÙØ­Ø§Øª)
         */
        function attachEventListeners() {
            // Ù…Ø³ØªÙ…Ø¹Ùˆ Ø£Ø²Ø±Ø§Ø± "Ø§Ù„Ø±Ø¯" (Ù„Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø¯)
            document.querySelectorAll('.replyBtn').forEach(btn => {
                btn.onclick = (e) => {
                    const id = e.target.dataset.id;
                    const replyForm = document.getElementById(`replyForm-${id}`);

                    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø£Ø®Ø±Ù‰ Ø§Ù„Ù…ÙØªÙˆØ­Ø©
                    document.querySelectorAll('.reply-form').forEach(form => {
                        if (form.id !== replyForm.id) {
                            form.style.display = 'none';
                        }
                    });

                    // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ
                    replyForm.style.display = replyForm.style.display === 'block' ? 'none' : 'block';
                };
            });

            // Ù…Ø³ØªÙ…Ø¹Ùˆ Ø£Ø²Ø±Ø§Ø± "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯"
            document.querySelectorAll('.sendReplyBtn').forEach(btn => {
                btn.onclick = async (e) => {
                    const parentId = e.target.dataset.parentId;
                    const nameInput = document.getElementById(`rName-${parentId}`);
                    const msgInput = document.getElementById(`rMsg-${parentId}`);

                    let name = nameInput.value.trim();
                    let msg = msgInput.value.trim();

                    if (!name || !msg) {
                        alert("Harap masukkan Nama dan Komen untuk membalas.");
                        return;
                    }

                    const replyData = {
                        name,
                        msg,
                        status: 'Balasan',
                        parentId: parentId,
                    };

                    await addCommentToSheet(replyData);

                    // ØªÙ†Ø¸ÙŠÙ ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                    nameInput.value = "";
                    msgInput.value = "";
                    document.getElementById(`replyForm-${parentId}`).style.display = 'none';
                };
            });
        }

        /**
         * 5. ÙˆØ¸ÙŠÙØ© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Kirim")
         */
        sendComment.onclick = async () => {
            let name = cName.value.trim();
            let msg = cMsg.value.trim();
            let st = cStatus.value;

            if (!name || !st) {
                alert("Harap masukkan nama dan Status Kehadiran.");
                return;
            }

            const mainCommentData = {
                name,
                msg,
                status: st,
                parentId: "" // ØªØ¹Ù„ÙŠÙ‚ Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ parentId
            };

            await addCommentToSheet(mainCommentData);
        };

        /** ğŸŸ¢ Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª ğŸŸ¢ */
        // Ø²Ø± "Ø§Ù„Ø³Ø§Ø¨Ù‚"
        prevBtn.onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                renderComments();
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
                commentsList.closest('#commentsWrapper').scrollTo({ top: 0, behavior: 'smooth' });
            }
        };

        // Ø²Ø± "Ø§Ù„ØªØ§Ù„ÙŠ"
        nextBtn.onclick = () => {
            const totalMainComments = allComments.filter(c => !c.parentId || c.parentId === 'null' || c.parentId === '').length;
            const totalPages = Math.ceil(totalMainComments / COMMENTS_PER_PAGE);
            if (currentPage < totalPages) {
                currentPage++;
                renderComments();
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø£Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
                commentsList.closest('#commentsWrapper').scrollTo({ top: 0, behavior: 'smooth' });
            }
        };
        /** ----------------------------- */

        /**
         * 6. ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©: Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
         */
        async function initComments() {
            await getCommentsFromSheet();
            renderComments();
        }

        // Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        initComments();
    </script>

</body>
</html>